<!DOCTYPE html>
<html>
<head lang="en">
   <meta charset="utf-8">
   <title>Activity Log</title>
   <script src="Stay.js"></script>
   <script>

      // Wait until the window finishes loaded before executing any script
      window.onload = function() {


        let orgPersons = [];
        let orgNights = [];
        var orgCosts;

        // Initialize the activityNumber
        var activityNumber = 1;

        // Select the add_activity button
        var addButton = document.getElementById("add_activity");

        // Select the calculate button
        var calcButton = document.getElementById("calculate");

        // Select the table element
        var divTable = document.getElementById("divlist");

        // Select the table element
        var resultTable = document.getElementById("resultlist");

        var totalCost, totalNights;

        const stay = new Stay(document.getElementById("totalCost").value, document.getElementById("totalNights").value);

        // Attach handler to the button click event
        addButton.onclick = function() {

        // Add a new row to the table using the correct activityNumber
          divTable.innerHTML += '<tr><td><label>Person ' + activityNumber + ': </label><br/> \
            <input type="text" name="person' + activityNumber + '" id="person' + activityNumber + '" class="required" placeholder="Name"> \
            <input type="text" id="nightS' + activityNumber + '" name="nights' + activityNumber + '" value="" placeholder="Nights"></td></tr>';

          // Increment the activityNumber
          activityNumber += 1;
        }

        document.getElementById("calculate").addEventListener("click", function() {

          totalCost = document.getElementById("totalCost").value;
          totalNights = document.getElementById("totalNights").value;

          const stay = new Stay(totalCost, totalNights);

          totalCost = document.getElementById("totalCost").value;
          totalNights = document.getElementById("totalNights").value;
          //stay.ChangeTotalPrice(document.getElementById("totalCost").value)
          //stay.ChangeTotalNights(document.getElementById("totalNights").value)

          var inputs, index;
          

          //Create NodeList
          inputs = document.getElementsByTagName('input');

          //convert nodelist into array
          var inputsArr = Array.from(inputs);



          for (index = 0; index < inputs.length-3; ++index) {
            var per, night;

            per = inputsArr[index].value;
            orgPersons.push(per);
            index++;
            night = inputsArr[index].value;
            orgNights.push(night);


            stay.AddPerson(per,  Array.from(String(night), Number));
          }

          orgCosts = stay.CalculateOriginalCosts();

          alert(orgCosts);

          for (index = 0; index < orgCosts.length; ++index) {
            divTable.innerHTML += '<tr><td><label>' + orgPersons[index] + ': </label><label>' + orgCosts[index] + '</label><br/></td></tr>';
          }

          //divTable.innerHTML += '<tr><td><button id="recalculate">Recalculate</button></td></tr>';

        }, false);


        document.getElementById("recalculate").addEventListener("click", function() {

          
          var recal = 1;
          var index;

          for (index = 0; index < orgPersons.length; ++index) {
            divTable.innerHTML += '<tr><td><label>' + orgPersons[index] + ' </label><br/> \
            <input type="text" name="reperson' + recal + '" id="reperson' + recal + '"  value="' + orgPersons[index] + '"> \
            <input type="text" name="renights' + recal + '" id="renights' + recal + '" value="' + orgNights[index] + '" ></td></tr>';
          }

        }, false);

        document.getElementById("redistribute").addEventListener("click", function() {

          var recal = 1;
          var index;
          let repersons = [];
          let renights =[];

          repersons = document.querySelector('[id^="reperson"]');
          var repersonsArr = Array.from(repersons);
          renights = document.querySelector('[id^="renights"]');
          var renightsArr = Array.from(renights);

          alert(renightsArr[0]);
          for (index = 0; index < repersonsArr.length; ++index) {
            stay.ChangePersonNights(repersonsArr[index].value, Array.from(String(renightsArr[index].value), Number))
          }

          redistCost = stay.CalculateRedistribution();
          alert(orgCosts);

        }, false);

      }

   </script>

</head>

<body>
  <div class="container">
      <div class="row">
          <div class="leftcol">
              <form name='mainForm' id='mainForm' method="get" action="#">
                <fieldset>
                   <legend>Input Information</legend>
                   <table id="divlist">
                    <!--tr>
                      <th colspan="3">Track List: </th>
                    </tr>
                    <tr>
                      <td>1</td>
                      <td> <label>Person 1: </label> <br/> <input type="text" id="person1" name="person1" value="" class="required"><input type="text" name="nights1" class="required"> </td>
                    </tr>
                    <tr>
                      <td>2</td>
                      <td><label>Person 2: </label><br/><input type="text" name="person2" id="person2" class="required"><input type="text" name="nights2" class="required"></td>
                    </tr-->
                   </table>
                </fieldset>
              </form>
              <button id="add_activity">Add Person</button>
              <button id="calculate">Calculate</button>
              <button id="recalculate">Recalculate</button>
              <button id="redistribute">Redistribute</button>
              <label>Total Cost: </label>
              <input type="number" name="totalCost" id="totalCost" class="required">
              <label>Total Number of Nights: </label>
              <input type="number" name="person2" id="totalNights"class="required">
          </div>
      </div>
  </div>
</body>
</html>

